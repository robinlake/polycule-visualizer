import React, {useState, useEffect, useRef} from 'react'
import * as d3 from 'd3';

// const node_data = [{"x":268.8271481639981,"y":145.2979039268128,"r":12.46125282122563},{"x":511.18833984458877,"y":112.16604452043472,"r":5.864922442800262},{"x":416.9630578674172,"y":169.69317895331915,"r":4.800515454020161},{"x":378.98641004029,"y":329.42000327896255,"r":8.94135608785407},{"x":588.8132439386272,"y":290.67012272958783,"r":5.371937867762396},{"x":384.54988949613005,"y":325.884387230319,"r":3},{"x":688.5335300370651,"y":285.6543199866577,"r":11.685873437378808},{"x":540.8780314553719,"y":300.1281063342223,"r":8.028284700916954},{"x":535.0884633268807,"y":233.59472897484682,"r":6.839368865824657},{"x":463.0570187546502,"y":392.5350780817871,"r":5.50701688109626},{"x":69.02694292586932,"y":148.3813035510287,"r":8.984624940219756},{"x":409.71660441782575,"y":220.57647189166508,"r":3},{"x":697.4202616757474,"y":224.94873075617835,"r":11.200730046995952},{"x":496.32149089050944,"y":189.49363484312343,"r":9.215562924218434},{"x":618.4779250320684,"y":157.65146173015404,"r":3},{"x":629.692377066527,"y":173.49327478515417,"r":12.49427592258402},{"x":580.6064471050835,"y":347.43241600538096,"r":9.387130264442977},{"x":597.2832848883231,"y":255.51786353429924,"r":3.925517625930391},{"x":640.8854878925544,"y":281.7343697109938,"r":4.595361422360533},{"x":321.714213913092,"y":185.5762632784231,"r":4.8244030243747815},{"x":335.9178922497602,"y":214.09240070493928,"r":10.97836828471352},{"x":445.3056007432907,"y":275.23968092783247,"r":7.2249057463927775},{"x":603.0649006644877,"y":323.70074537062754,"r":11.395159431603332},{"x":344.9676668537502,"y":181.30813831771607,"r":13.533910184674795},{"x":622.9081421886785,"y":234.1110835140362,"r":10.85911233100826},{"x":423.870585412592,"y":247.66438300004702,"r":5.163908510872341},{"x":469.38203159817004,"y":359.33253572077615,"r":5.911778473379107},{"x":617.6082492728762,"y":182.14933256294046,"r":3},{"x":381.5094558327635,"y":182.5203659395815,"r":3},{"x":539.4489802665369,"y":196.49156788079227,"r":3},{"x":706.1016715327521,"y":207.77930865805246,"r":12.672866171826954},{"x":492.7772028775822,"y":282.95179452568055,"r":9.879929404147948},{"x":468.9252827349578,"y":271.9648426687377,"r":3},{"x":353.8228041901028,"y":274.25735274846323,"r":7.294582917029463},{"x":242.38928264087286,"y":189.0119373693943,"r":8.565441334754901},{"x":440.70174185874754,"y":220.19803607746937,"r":13.53323969735639},{"x":527.9111396132871,"y":240.1187427958874,"r":11.476148444935617},{"x":603.9867182440282,"y":134.06285514763636,"r":3},{"x":594.0598833370962,"y":374.1244585969125,"r":5.8439040931401385},{"x":306.3628163273025,"y":250.32215199937716,"r":8.73513419769011},{"x":403.04259376128414,"y":257.1090531337551,"r":13.22801788730927},{"x":327.3079215474436,"y":245.2433550805372,"r":4.421839945547276},{"x":682.0402278128769,"y":335.9022379432038,"r":5.622746831421178},{"x":535.8377767212363,"y":184.57371129252888,"r":3.970979026758081},{"x":415.00430679640795,"y":194.39091042976344,"r":11.884625495205754},{"x":246.1700745674728,"y":240.58335355384858,"r":12.344282078782559},{"x":446.07445818784134,"y":175.08003891727668,"r":5.570629801588929},{"x":452.07431619685894,"y":206.40258928309544,"r":4.60927605742835},{"x":469.11517848806824,"y":382.42725408943346,"r":11.73382990086872},{"x":470.26016435250835,"y":188.35207710898885,"r":14.345354657108919},{"x":381.67470679514486,"y":353.3535919109137,"r":3.040852747805741},{"x":427.5254982355833,"y":125.5004852928824,"r":10.987472797126564},{"x":446.11274176201425,"y":208.6038372062067,"r":8.906813657028874},{"x":613.4081178721094,"y":212.6940718801365,"r":10.067008919462225},{"x":489.08896395653994,"y":233.95156925254642,"r":6.232717707027025},{"x":315.9940811806373,"y":366.0985401469246,"r":17.281908552463698},{"x":616.3426091474208,"y":306.28977595687763,"r":7.663513064596242},{"x":344.2820737710644,"y":318.0655412704957,"r":8.539600160024047},{"x":365.3138494030992,"y":138.9642968868844,"r":12.509636484534472},{"x":511.23251259487296,"y":78.8161046897463,"r":7.180219559016923},{"x":594.8605894569134,"y":305.95137820816745,"r":10.776146233170076},{"x":494.2819609981207,"y":230.17625775972007,"r":3.8878874456349095},{"x":390.0040185387662,"y":208.09267728351153,"r":5.668736025646033},{"x":463.17346598936155,"y":305.76422569144034,"r":8.662016169723215},{"x":327.4406209950456,"y":198.30109137773894,"r":3},{"x":197.8123721402419,"y":382.0770478258211,"r":10.190424779384},{"x":402.2154445410851,"y":306.11190573174673,"r":7.006489780273418},{"x":351.2648146714518,"y":297.39767142859927,"r":8.815341546097713},{"x":243.92723402536188,"y":253.57274484202225,"r":4.729722242453427},{"x":764.4655914087499,"y":242.7651120791977,"r":7.173823667226639},{"x":483.8089359080305,"y":214.61005906035032,"r":3.8443341171911527},{"x":461.3143279562497,"y":197.25254670652092,"r":16.129536720670295},{"x":340.643361654459,"y":279.629081002213,"r":5.78794062825603},{"x":212.5255021297258,"y":311.795826984147,"r":17.699894924855144},{"x":426.34723185161675,"y":216.57152893681302,"r":17.88707863966254},{"x":620.9635576368855,"y":326.69295972485764,"r":11.43856693587446},{"x":339.69504133020223,"y":345.83387614164263,"r":6.904650549245117},{"x":554.4837462546641,"y":288.56335358630645,"r":8.711408563682985},{"x":332.30809116550085,"y":191.2341296843433,"r":13.963011127500117},{"x":504.7747721781146,"y":156.20290175577193,"r":7.682329478011834},{"x":406.5831156319242,"y":137.37448123536896,"r":8.677197683674118},{"x":352.810888814217,"y":291.16271586435835,"r":15.397388252796947},{"x":269.47072005472376,"y":343.7232143163451,"r":7.30457890309548},{"x":522.7788286592496,"y":238.07597759223188,"r":12.578193145711799},{"x":329.3488400371446,"y":265.84309483741805,"r":9.330745947130369},{"x":417.8410111892689,"y":346.2682984476292,"r":14.6081280717037},{"x":501.9074165559893,"y":289.4623483446181,"r":5.576812131883458},{"x":616.0711385083416,"y":316.5587666003403,"r":11.79452784001242},{"x":450.62260710855867,"y":282.1194891760307,"r":4.232793550103077},{"x":513.1272586496269,"y":248.13385264459225,"r":11.409481898619491},{"x":465.1094151006849,"y":257.3180493204069,"r":16.543181371351324},{"x":750.4169992630448,"y":167.50839972984735,"r":16.67154363678067},{"x":148.99045243434097,"y":285.4026967443929,"r":5.488510065025583},{"x":608.6499505613205,"y":259.1376663527708,"r":12.900166772564464},{"x":548.5678408301601,"y":355.0665000076723,"r":9.101737871979575},{"x":359.25172015489824,"y":241.96125058735905,"r":6.424224234299812},{"x":575.9931249878028,"y":147.97330245747273,"r":4.068927035043689},{"x":382.7522564044218,"y":227.60792604421184,"r":3},{"x":382.7418395262921,"y":297.0543959347447,"r":9.204216792356595},{"x":449.61798723081205,"y":218.65808643381638,"r":10.950712546013168}]
// const edge_data = [{"source":0,"target":42},{"source":1,"target":80},{"source":2,"target":89},{"source":3,"target":27},{"source":4,"target":87},{"source":5,"target":2},{"source":6,"target":30},{"source":7,"target":89},{"source":8,"target":2},{"source":9,"target":48},{"source":10,"target":0},{"source":11,"target":89},{"source":12,"target":91},{"source":13,"target":39},{"source":14,"target":31},{"source":15,"target":44},{"source":16,"target":12},{"source":17,"target":63},{"source":18,"target":48},{"source":19,"target":74},{"source":20,"target":45},{"source":21,"target":20},{"source":22,"target":99},{"source":23,"target":25},{"source":24,"target":12},{"source":25,"target":76},{"source":26,"target":70},{"source":27,"target":10},{"source":28,"target":9},{"source":29,"target":23},{"source":30,"target":21},{"source":31,"target":29},{"source":32,"target":36},{"source":33,"target":42},{"source":34,"target":45},{"source":35,"target":29},{"source":36,"target":71},{"source":37,"target":64},{"source":38,"target":10},{"source":39,"target":48},{"source":40,"target":95},{"source":42,"target":68},{"source":43,"target":10},{"source":44,"target":57},{"source":45,"target":33},{"source":46,"target":26},{"source":47,"target":68},{"source":48,"target":85},{"source":49,"target":56},{"source":50,"target":23},{"source":51,"target":79},{"source":52,"target":46},{"source":53,"target":44},{"source":54,"target":22},{"source":55,"target":80},{"source":56,"target":65},{"source":57,"target":27},{"source":58,"target":23},{"source":59,"target":64},{"source":60,"target":67},{"source":61,"target":50},{"source":62,"target":10},{"source":63,"target":16},{"source":64,"target":70},{"source":65,"target":0},{"source":66,"target":17},{"source":67,"target":42},{"source":68,"target":20},{"source":69,"target":51},{"source":70,"target":60},{"source":71,"target":45},{"source":72,"target":13},{"source":73,"target":71},{"source":74,"target":64},{"source":75,"target":58},{"source":76,"target":65},{"source":77,"target":29},{"source":78,"target":15},{"source":79,"target":42},{"source":80,"target":21},{"source":81,"target":13},{"source":82,"target":75},{"source":83,"target":58},{"source":84,"target":94},{"source":85,"target":6},{"source":86,"target":46},{"source":87,"target":37},{"source":88,"target":30},{"source":89,"target":13},{"source":90,"target":69},{"source":91,"target":8},{"source":92,"target":76},{"source":93,"target":99},{"source":94,"target":79},{"source":95,"target":69},{"source":96,"target":98},{"source":97,"target":9},{"source":98,"target":86},{"source":99,"target":93}]

function ForceDirectedGraph() {
    //create somewhere to put the force directed graph
    const d3Container = useRef(null);

    useEffect(() => {
        if (d3Container) {
            var svg = d3.select("svg"),
            width = +svg.attr("width"),
            height = +svg.attr("height");
        
            var nodes_data =  [
                {"name": "Travis", "sex": "M"},
                {"name": "Rake", "sex": "M"},
                {"name": "Diana", "sex": "F"},
                {"name": "Rachel", "sex": "F"},
                {"name": "Shawn", "sex": "M"},
                {"name": "Emerald", "sex": "F"}
                ]
            
            const simulation = d3.forceSimulation()
                .nodes(nodes_data);
                
            //add forces
            //we're going to add a charge to each node 
            //also going to add a centering force
            simulation
            .force("charge_force", d3.forceManyBody())
            .force("center_force", d3.forceCenter(width / 2, height / 2));

            //draw circles for the nodes 
            var node = svg.append("g")
            .attr("class", "nodes")
            .selectAll("circle")
            .data(nodes_data)
            .enter()
            .append("circle")
            .attr("r", 5)
            .attr("fill", "red");  

            //add tick instructions: 
            simulation.on("tick", tickActions );

            //Create links data 
            var links_data = [
                {"source": "Travis", "target": "Rake"},
                {"source": "Diana", "target": "Rake"},
                {"source": "Diana", "target": "Rachel"},
                {"source": "Rachel", "target": "Rake"},
                {"source": "Rachel", "target": "Shawn"},
                {"source": "Emerald", "target": "Rachel"}
            ]



            //Create the link force 
            //We need the id accessor to use named sources and targets 

            var link_force =  d3.forceLink(links_data)
                                    .id(function(d) { return d.name; })

            //Add a links force to the simulation
            //Specify links  in d3.forceLink argument  
            simulation.force("links",link_force)
            
            //draw lines for the links 
            var link = svg.append("g")
            .attr("class", "links")
            .selectAll("line")
            .data(links_data)
            .enter().append("line")
            .attr("stroke-width", 2); 

            function tickActions() {
                //update circle positions each tick of the simulation 
                node
                    .attr("cx", function(d) { return d.x; })
                    .attr("cy", function(d) { return d.y; });
                    
                //update link positions 
                //simply tells one end of the line to follow one node around
                //and the other end of the line to follow the other node around
                link
                    .attr("x1", function(d) { return d.source.x; })
                    .attr("y1", function(d) { return d.source.y; })
                    .attr("x2", function(d) { return d.target.x; })
                    .attr("y2", function(d) { return d.target.y; });
            
              }   

        }
    }, [d3Container])

    
    return (
        <div>
            force directed graph
            <svg
                className="d3-component"
                width={400}
                height={200}
                ref={d3Container}
            />
        </div>
    )
}

export default ForceDirectedGraph
